<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archived PDF Test</title>
</head>
<body>
    <h2 id="current-folder-title">Available Files</h2>
    <button id="back-button" style="display: none;" onclick="goBack()">Back</button>
    <ul id="file-list"></ul>

    <script>
        const username = "daveidsww";  
        const repo = "national-archives";  
        const branch = "main";  
        let currentFolder = "pdf";  
        let folderHistory = [];  

        async function fetchFiles(folderPath) {
            const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${folderPath}?ref=${branch}`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error("Failed to fetch files");

                const files = await response.json();
                const fileList = document.getElementById("file-list");
                const folderTitle = document.getElementById("current-folder-title");
                fileList.innerHTML = "";
                
                folderTitle.textContent = `Current Folder: ${folderPath}`;
                
                files.forEach(file => {
                    const listItem = document.createElement("li");
                    const fileLink = document.createElement("a");

                    if (file.type === "dir") {
                        fileLink.href = "#";
                        fileLink.textContent = `📁 ${file.name}`;
                        fileLink.onclick = () => {
                            folderHistory.push(currentFolder);
                            currentFolder = file.path;
                            fetchFiles(currentFolder);
                            updateBackButton();
                        };
                    } else if (file.name.endsWith(".pdf")) {
                        fileLink.href = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/${file.path}`;
                        fileLink.textContent = file.name;
                        fileLink.target = "_blank";
                    }

                    listItem.appendChild(fileLink);
                    fileList.appendChild(listItem);
                });
            } catch (error) {
                console.error("Error fetching file list:", error);
            }
        }

        function goBack() {
            if (folderHistory.length > 0) {
                currentFolder = folderHistory.pop();
                fetchFiles(currentFolder);
                updateBackButton();
            }
        }

        function updateBackButton() {
            document.getElementById("back-button").style.display = folderHistory.length > 0 ? "block" : "none";
        }

        fetchFiles(currentFolder);
    </script>
</body>
</html>
